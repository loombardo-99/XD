<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leitura de Ebooks - XD</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="css/previsoes.css">
</head>
<body>
    <div class="overlay" id="overlay"></div>

    <span class="menu-icon" onclick="toggleMenu()">&#9776;</span>
    <nav id="main-nav">
        <ul>
            <li><a href="public/home.html">Assistente</a></li>
            <li><a href="public/leitura.html">Leitura</a></li>
            <li><a href="public/comunidade.html">Comunidade</a></li>
            <li><a href="public/editor.html">Editor</a></li>
            <li>
                <select onchange="handleMenuSelection(this.value)" class="menu-select">
                    <option value="perfil.html" disabled selected>Perfil</option>
                    <option value="configuracoes.html">Configurações</option>
                    <option value="politicas.html">Políticas de Privacidade</option>
                    <option value="index.html">Sair</option>
                </select>
            </li>
        </ul>
    </nav>
    <div class="ebook-container">
        <div class="search-area">
            <input type="text" id="search-input" placeholder="Pesquisar livros na internet..." onkeypress="handleSearchKeyPress(event)">
            <button onclick="searchBooks()"><i class="fas fa-search"></i> Buscar</button>
        </div>

        <div class="ebook-header">
            <h1 id="ebook-title">Título do Ebook</h1>
        </div>
        <div class="ebook-content" id="ebook-content">
            <p>Este é um parágrafo de exemplo para o seu ebook. Você pode carregar o conteúdo real do seu ebook aqui. O design é minimalista e focado na legibilidade, com um fundo escuro para reduzir o cansaço visual, especialmente em ambientes com pouca luz.</p>
            <p>A navegação entre as páginas pode ser feita pelos botões abaixo. Os controles de fonte e tema permitem personalizar sua experiência de leitura. Nosso objetivo é proporcionar um ambiente limpo e sem distrações para que você possa se concentrar totalmente na sua leitura.</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
            <p>Curabitur pretium tincidunt lacus. Nulla gravida orci a odio. Nullam varius, turpis et commodo pharetra, est eros bibendum elit, nec luctus magna felis sollicitudin mauris. Integer in mauris eu nibh euismod gravida. Duis ac tellus et risus auctor iaculis. Mauris vel nisl. Cras a nunc. Donec adipiscing mollis scelerisque. Sed mollis, eros et ultrices tempus, mauris ipsum aliquam nulla, at volutpat sem arcu sed ipsum. Donec non dolor. In hac habitasse platea dictumst. Aliquam eu elit. Nunc sed elit. Donec at odio sit amet nibh vulputate cursus. Nulla facilisi. Fusce at massa sed arcu egestas.</p>
            <p>Praesent dapibus, neque id cursus faucibus, tortor neque egestas augu, eu vulputate magna eros eu erat. Aliquam erat volutpat. Nam dui mi, tincidunt quis, accumsan porttitor, facilisis luctus, metus. Phasellus ultrices nulla quis nibh. Quisque a lectus. Donec consectetuer ligula vulputate sem tristique cursus. Nam nulla quam, gravida non, commodo a, sodales sit amet, nisi. Pellentesque fermentum dolor. Aliquam quam lectus, facilisis vitae, aliquam et, ultrices in, mauris. Sed adipiscing ornare risus. Morbi est est, blandit sit amet, sagittis vel, adipiscing non, dolor. Sed in justo. Phasellus at dolor in nisl iaculis egestas. Nulla facilisi. Etiam id elit, et ac facilisis turpis.</p>
            <p>Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; In hac habitasse platea dictumst. Mauris non ligula. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam.</p>
        </div>
        <div class="ebook-controls">
            <button onclick="prevPage()"><i class="fas fa-arrow-left"></i> Página Anterior</button>
            <select id="font-size-select" onchange="changeFontSize(this.value)">
                <option value="1.0rem" selected>Tamanho da Fonte</option>
                <option value="0.9rem">Pequena</option>
                <option value="1.0rem">Média</option>
                <option value="1.1rem">Grande</option>
                <option value="1.2rem">Extra Grande</option>
            </select>
            <select id="theme-select" onchange="changeTheme(this.value)">
                <option value="dark" selected>Tema</option>
                <option value="dark">Escuro</option>
                <option value="light">Claro</option>
                <option value="sepia">Sépia</option>
            </select>
            <button onclick="nextPage()">Próxima Página <i class="fas fa-arrow-right"></i></button>
            <button onclick="summarizePage()">✨ Resumir Página</button> </div>

        <div class="search-results" id="search-results">
            </div>

        <div class="loading-indicator" id="loading-indicator">
            <div class="spinner"></div>
            <span>Buscando livros...</span>
        </div>

        <div class="summary-results" id="summary-results">
            </div>
        <div class="loading-indicator" id="summary-loading-indicator">
            <div class="spinner"></div>
            <span>Gerando resumo...</span>
        </div>
    </div>
    <script>
        // Função para alternar a visibilidade do menu
        function toggleMenu() {
            const nav = document.getElementById('main-nav');
            const overlay = document.getElementById('overlay');
            if (nav.classList.contains('open')) {
                nav.classList.remove('open');
                overlay.classList.remove('active');
                document.body.style.overflow = ''; // Reabilita a rolagem do corpo
            } else {
                nav.classList.add('open');
                overlay.classList.add('active');
                document.body.style.overflow = 'hidden'; // Desabilita a rolagem do corpo quando o menu está aberto
            }
        }

        // Fecha o menu se clicar fora dele ou no overlay
        document.addEventListener('click', function(event) {
            const nav = document.getElementById('main-nav');
            const menuIcon = document.querySelector('.menu-icon');
            const overlay = document.getElementById('overlay');

            // Verifica se o clique não foi no menu nem no ícone do menu
            if (nav.classList.contains('open') && !nav.contains(event.target) && !menuIcon.contains(event.target)) {
                nav.classList.remove('open');
                overlay.classList.remove('active');
                document.body.style.overflow = ''; // Reabilita a rolagem do corpo
            }
        });

        // Função para lidar com a seleção do menu (redirecionamento)
        function handleMenuSelection(value) {
            if (value) {
                window.location.href = value;
            }
        }

        // --- Funções Específicas do Ebook Reader ---
        const ebookContent = document.getElementById('ebook-content');
        const ebookTitle = document.getElementById('ebook-title');
        let currentPage = 0;
        const pages = []; // Array para armazenar o conteúdo das páginas

        // Simula o carregamento de conteúdo e divisão em páginas
        function loadEbookContent() {
            // Para este exemplo, o conteúdo é estático.
            // Em uma aplicação real, você carregaria o texto de um arquivo ou API.
            const initialText = `Este é um parágrafo de exemplo para o seu ebook. Você pode carregar o conteúdo real do seu ebook aqui. O design é minimalista e focado na legibilidade, com um fundo escuro para reduzir o cansaço visual, especialmente em ambientes com pouca luz.

            A navegação entre as páginas pode ser feita pelos botões abaixo. Os controles de fonte e tema permitem personalizar sua experiência de leitura. Nosso objetivo é proporcionar um ambiente limpo e sem distrações para que você possa se concentrar totalmente na sua leitura.

            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

            Curabitur pretium tincidunt lacus. Nulla gravida orci a odio. Nullam varius, turpis et commodo pharetra, est eros bibendum elit, nec luctus magna felis sollicitudin mauris. Integer in mauris eu nibh euismod gravida. Duis ac tellus et risus auctor iaculis. Mauris vel nisl. Cras a nunc. Donec adipiscing mollis scelerisque. Sed mollis, eros et ultrices tempus, mauris ipsum aliquam nulla, at volutpat sem arcu sed ipsum. Donec non dolor. In hac habitasse platea dictumst. Aliquam eu elit. Nunc sed elit. Donec at odio sit amet nibh vulputate cursus. Nulla facilisi. Fusce at massa sed arcu egestas.

            Praesent dapibus, neque id cursus faucibus, tortor neque egestas augu, eu vulputate magna eros eu erat. Aliquam erat volutpat. Nam dui mi, tincidunt quis, accumsan porttitor, facilisis luctus, metus. Phasellus ultrices nulla quis nibh. Quisque a lectus. Donec consectetuer ligula vulputate sem tristique cursus. Nam nulla quam, gravida non, commodo a, sodales sit amet, nisi. Pellentesque fermentum dolor. Aliquam quam lectus, facilisis vitae, aliquam et, ultrices in, mauris. Sed adipiscing ornare risus. Morbi est est, blandit sit amet, sagittis vel, adipiscing non, dolor. Sed in justo. Phasellus at dolor in nisl iaculis egestas. Nulla facilisi. Etiam id elit, et ac facilisis turpis.

            Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; In hac habitasse platea dictumst. Mauris non ligula. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam. Sed quis diam.`;

            ebookContent.innerHTML = ''; // Limpa o conteúdo para recarregar paginado
            pages.length = 0; // Limpa o array de páginas

            // Simples divisão de páginas por parágrafos para melhor legibilidade
            const paragraphs = initialText.split('\n').filter(p => p.trim() !== '');
            let currentPageContent = '';
            const maxCharsPerPage = 1000; // Limite de caracteres por página

            paragraphs.forEach(p => {
                if ((currentPageContent + p).length < maxCharsPerPage) {
                    currentPageContent += `<p>${p}</p>`;
                } else {
                    pages.push(currentPageContent);
                    currentPageContent = `<p>${p}</p>`;
                }
            });
            if (currentPageContent) {
                pages.push(currentPageContent);
            }
            displayPage(currentPage);
        }

        function displayPage(pageNumber) {
            if (pages[pageNumber]) {
                ebookContent.innerHTML = pages[pageNumber];
                currentPage = pageNumber;
                ebookContent.scrollTop = 0; // Rola para o topo da nova página
            }
        }

        function nextPage() {
            if (currentPage < pages.length - 1) {
                displayPage(currentPage + 1);
            }
        }

        function prevPage() {
            if (currentPage > 0) {
                displayPage(currentPage - 1);
            }
        }

        function changeFontSize(size) {
            ebookContent.style.fontSize = size;
        }

        function changeTheme(theme) {
            // Remove classes de tema existentes
            document.body.classList.remove('dark-theme', 'light-theme', 'sepia-theme');
            ebookContent.classList.remove('dark-theme', 'light-theme', 'sepia-theme');

            // Adiciona a classe do novo tema
            if (theme === 'dark') {
                document.body.style.backgroundColor = '#000000';
                ebookContent.style.backgroundColor = 'rgba(255, 255, 255, 0.05)';
                ebookContent.style.color = '#ffffff';
            } else if (theme === 'light') {
                document.body.style.backgroundColor = '#f0f0f0';
                ebookContent.style.backgroundColor = '#ffffff';
                ebookContent.style.color = '#333333';
            } else if (theme === 'sepia') {
                document.body.style.backgroundColor = '#fbf0d9';
                ebookContent.style.backgroundColor = '#fbf0d9';
                ebookContent.style.color = '#5a4632';
            }
        }

        // --- Funções de Pesquisa de Livros ---
        const searchInput = document.getElementById('search-input');
        const searchResultsContainer = document.getElementById('search-results');
        const loadingIndicator = document.getElementById('loading-indicator');

        async function searchBooks() {
            const searchTerm = searchInput.value.trim();
            if (!searchTerm) {
                searchResultsContainer.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.7);">Por favor, digite um termo de pesquisa.</p>';
                searchResultsContainer.classList.add('active');
                return;
            }

            searchResultsContainer.innerHTML = ''; // Limpa resultados anteriores
            searchResultsContainer.classList.remove('active');
            loadingIndicator.classList.add('active'); // Mostra o indicador de carregamento

            try {
                const searchQueries = [
                    searchTerm + " livro",
                    searchTerm + " resumo livro",
                    searchTerm + " sinopse livro"
                ];

                // Simulação de pesquisa na internet (substitua por uma API real como Google Books API)
                // Para este exemplo, vamos simular respostas com base no termo de pesquisa.
                const simulatedResults = {
                    "harry potter": [
                        {
                            title: "Harry Potter e a Pedra Filosofal",
                            author: "J.K. Rowling",
                            description: "Um órfão descobre que é um bruxo no seu décimo primeiro aniversário e é enviado para Hogwarts, uma escola de magia e bruxaria."
                        },
                        {
                            title: "Harry Potter e a Câmara Secreta",
                            author: "J.K. Rowling",
                            description: "No seu segundo ano em Hogwarts, Harry descobre que uma câmara secreta foi aberta, liberando um monstro que petrifica os alunos."
                        }
                    ],
                    "senhor dos aneis": [
                        {
                            title: "O Senhor dos Anéis: A Sociedade do Anel",
                            author: "J.R.R. Tolkien",
                            description: "Um hobbit chamado Frodo Bolseiro herda um anel mágico e embarca em uma perigosa jornada para destruí-lo e salvar a Terra Média."
                        }
                    ],
                    "inteligencia artificial": [
                        {
                            title: "Inteligência Artificial: Uma Abordagem Moderna",
                            author: "Stuart Russell, Peter Norvig",
                            description: "Um livro abrangente que cobre os fundamentos da inteligência artificial, desde busca e raciocínio lógico até aprendizado de máquina e redes neurais."
                        },
                        {
                            title: "A Revolução da Inteligência Artificial",
                            author: "Kai-Fu Lee",
                            description: "Uma análise sobre como a IA está transformando o mundo, com foco nos avanços na China e nos EUA e seu impacto na sociedade."
                        }
                    ],
                    "clean code": [
                        {
                            title: "Clean Code: A Handbook of Agile Software Craftsmanship",
                            author: "Robert C. Martin",
                            description: "Um guia prático para escrever código limpo, legível e de fácil manutenção, essencial para desenvolvedores de software."
                        }
                    ],
                    "default": [
                        {
                            title: `Livro sobre "${searchTerm}"`,
                            author: "Autor Desconhecido",
                            description: `Nenhum resumo específico encontrado para "${searchTerm}", mas aqui está um exemplo de resultado. Em uma aplicação real, você integraria uma API de pesquisa de livros.`
                        }
                    ]
                };

                await new Promise(resolve => setTimeout(resolve, 1500)); // Simula delay da rede

                let results = simulatedResults[searchTerm.toLowerCase()] || simulatedResults["default"];

                if (results.length > 0) {
                    results.forEach(book => {
                        const resultItem = document.createElement('div');
                        resultItem.classList.add('search-result-item');
                        resultItem.innerHTML = `
                            <h3>${book.title}</h3>
                            <p><strong>Autor:</strong> ${book.author}</p>
                            <p>${book.description}</p>
                            <button class="read-button" onclick="loadBookContent('${encodeURIComponent(book.title)}', '${encodeURIComponent(book.description)}')">Ler Resumo</button>
                        `;
                        searchResultsContainer.appendChild(resultItem);
                    });
                    searchResultsContainer.classList.add('active');
                } else {
                    searchResultsContainer.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.7);">Nenhum livro encontrado para este termo.</p>';
                    searchResultsContainer.classList.add('active');
                }
            } catch (error) {
                console.error('Erro ao pesquisar livros:', error);
                searchResultsContainer.innerHTML = '<p style="text-align: center; color: #ff6347;">Ocorreu um erro ao buscar livros. Tente novamente.</p>';
                searchResultsContainer.classList.add('active');
            } finally {
                loadingIndicator.classList.remove('active'); // Esconde o indicador de carregamento
            }
        }

        // Carrega o resumo do livro selecionado para a área de leitura
        function loadBookContent(title, description) {
            ebookTitle.textContent = decodeURIComponent(title);
            ebookContent.innerHTML = `<p>${decodeURIComponent(description)}</p><p>Para uma experiência de leitura completa, esta seção seria expandida com o conteúdo real do livro.</p>`;
            ebookContent.scrollTop = 0; // Rola para o topo do conteúdo do livro
            searchResultsContainer.classList.remove('active'); // Esconde os resultados da pesquisa
            searchInput.value = ''; // Limpa o campo de pesquisa
            
            // Recarrega o conteúdo de exemplo do ebook após 3 segundos, ou você pode manter o resumo
            // setTimeout(() => {
            //     ebookTitle.textContent = "Título do Ebook";
            //     loadEbookContent();
            // }, 3000); 
        }

        function handleSearchKeyPress(event) {
            if (event.key === 'Enter') {
                searchBooks();
            }
        }

        // --- Nova função para resumir a página com a API Gemini ---
        const summaryResultsContainer = document.getElementById('summary-results');
        const summaryLoadingIndicator = document.getElementById('summary-loading-indicator');

        async function summarizePage() {
            const pageText = ebookContent.textContent;
            if (!pageText.trim()) {
                summaryResultsContainer.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.7);">Não há conteúdo para resumir nesta página.</p>';
                summaryResultsContainer.classList.add('active');
                return;
            }

            summaryResultsContainer.innerHTML = ''; // Limpa resultados anteriores
            summaryResultsContainer.classList.remove('active');
            summaryLoadingIndicator.classList.add('active'); // Mostra o indicador de carregamento

            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: `Resuma o seguinte texto de um livro de forma concisa e clara em português:\n\n${pageText}` }] });
                const payload = { contents: chatHistory };
                const apiKey = "AIzaSyA__uvaQCm1NUNi60DJ8QZIrk44hz3yBG8"; // Se quiser usar modelos diferentes de gemini-2.0-flash ou imagen-3.0-generate-002, forneça uma chave de API aqui. Caso contrário, deixe como está.
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const summaryText = result.candidates[0].content.parts[0].text;
                    summaryResultsContainer.innerHTML = `<h3>Resumo da Página</h3><p>${summaryText}</p>`;
                    summaryResultsContainer.classList.add('active');
                } else {
                    summaryResultsContainer.innerHTML = '<p style="text-align: center; color: #ff6347;">Não foi possível gerar o resumo. Tente novamente.</p>';
                    summaryResultsContainer.classList.add('active');
                }
            } catch (error) {
                console.error('Erro ao gerar resumo:', error);
                summaryResultsContainer.innerHTML = '<p style="text-align: center; color: #ff6347;">Ocorreu um erro ao gerar o resumo. Verifique sua conexão ou tente novamente.</p>';
                summaryResultsContainer.classList.add('active');
            } finally {
                summaryLoadingIndicator.classList.remove('active'); // Esconde o indicador de carregamento
            }
        }

        // Carrega o conteúdo do ebook quando a página é carregada
        window.onload = loadEbookContent;
    </script>
</body>
</html>
